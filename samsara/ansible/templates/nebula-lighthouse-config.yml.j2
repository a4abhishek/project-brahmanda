# Nebula Configuration - Lighthouse
# Generated by Ansible for {{ inventory_hostname }}
# Do not edit manually - changes will be overwritten

pki:
  ca: {{ nebula_config_dir }}/ca.crt
  cert: {{ nebula_config_dir }}/lighthouse.crt
  key: {{ nebula_config_dir }}/lighthouse.key

# Static host map - Maps Nebula IPs to real IPs
# This helps with initial connection establishment
static_host_map:
  # Lighthouse is reachable at its public IP
  "{{ lighthouse_ip.split('/')[0] }}": ["{{ ansible_host }}:{{ lighthouse_port }}"]

# Lighthouse configuration
lighthouse:
  am_lighthouse: true
  # Serve DNS queries for the Nebula network
  serve_dns: false
  # Lighthouse doesn't need to know about other lighthouses (it IS the lighthouse)
  hosts: []

# Listen configuration
listen:
  host: 0.0.0.0
  port: {{ lighthouse_port }}
  batch: 64
  read_buffer: 10485760
  write_buffer: 10485760

# Punchy configuration for NAT traversal
punchy:
  punch: true
  respond: true
  delay: 1s

# Cipher suite
cipher: aes

# Port used for local processes to query nebula stats
#local_range: "127.0.0.1:4242"

# TUN/TAP device configuration
tun:
  disabled: false
  dev: nebula1
  drop_local_broadcast: false
  drop_multicast: false
  tx_queue: 500
  mtu: 1300
  
  routes:
    # No routes needed on lighthouse

# Logging configuration
logging:
  level: info
  format: text
  #disable_timestamp: false
  #timestamp_format: "2006-01-02T15:04:05.000Z07:00"

# Firewall rules for Nebula network
firewall:
  # Outbound rules
  outbound:
    # Allow all outbound traffic from lighthouse
    - port: any
      proto: any
      host: any

  # Inbound rules
  inbound:
    # Allow ICMP (ping) from any Nebula host
    - port: any
      proto: icmp
      host: any

    # Allow SSH from Nebula network
    - port: 22
      proto: tcp
      groups:
        - admin
        - edge
        - compute

    # Allow all traffic between edge nodes
    - port: any
      proto: any
      groups:
        - edge

# Stats configuration
stats:
  type: prometheus
  listen: 127.0.0.1:8080
  path: /metrics
  namespace: nebula
  subsystem: lighthouse
  interval: 10s
  message_metrics: false
  lighthouse_metrics: true
